<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>Getting Started Writing Clients</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li><a href="/yubikey-val">yubikey-val</a></li>
<li class="active">Getting Started Writing Clients</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/yubikey-val">yubikey-val</a><ul class="">
<li><a href="/yubikey-val/Release_Notes.html">Release Notes</a></li>
<li><a href="/yubikey-val/Installation.html">Installation</a></li>
<li><a href="/yubikey-val/Troubleshooting.html">Troubleshooting</a></li>
<li><a href="/yubikey-val/Client_Info_Format.html">Client Info Format</a></li>
<li><a href="/yubikey-val/Generating_Clients.html">Generating Clients</a></li>
<li class="active"><a href="/yubikey-val/Getting_Started_Writing_Clients.html">Getting Started Writing Clients</a>
<li><a href="/yubikey-val/Import_Export_Data.html">Import Export Data</a></li>
<li><a href="/yubikey-val/Make_Release.html">Make Release</a></li>
<li><a href="/yubikey-val/Munin_Probes.html">Munin Probes</a></li>
<li><a href="/yubikey-val/Revocation_Service.html">Revocation Service</a></li>
<li><a href="/yubikey-val/Server_Replication_Protocol.html">Server Replication Protocol</a></li>
<li><a href="/yubikey-val/Sync_Monitor.html">Sync Monitor</a></li>
<li><a href="/yubikey-val/Validation_Protocol_V2.0.html">Validation Protocol V2.0</a></li>
<li><a href="/yubikey-val/Validation_Server_Algorithm.html">Validation Server Algorithm</a></li>
<li><a href="/yubikey-val/YubiKey_Info_Format.html">YubiKey Info Format</a></li>
</li></ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/yubikey-val" rel="noopener noreferrer" target="_blank"><i class="fa fa-github fa-lg"></i> Github</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_getting_started_writing_clients">Getting Started Writing Clients</h1>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph"><p>While the canonical description of the validation protocol is
documented in <a href="Validation_Protocol_V2.0.html">Validation Protocol V2.0</a>,
it may be difficult to grasp the high level of how a client typically
works.  The intention with this page is to illustrate one simple case.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This does not cover the replicated protocol.</td>
</tr></table>
</div>
<div class="paragraph"><p>If you want to make your own client implementation, here is the
quickest way to get started:</p></div>
</div>
<div class="sect2">
<h3 id="_api_key">API key</h3>
<div class="paragraph"><p>API key is used to optionally sign the OTP validation request and to
verify the OTP validation response. We recommend all production
deployments use either API key or HTTPS.</p></div>
<div class="paragraph"><p>If you use HTTPS to access Yubico’s validation web service and you
validate the Yubico server SSL certificate, you don’t need to use the
shared key to further authenticate response signatures from Yubico.</p></div>
<div class="paragraph"><p>If you for some reason do not want to rely on HTTPS. You may also sign
requests using this API key.</p></div>
<div class="paragraph"><p>To get an API key, first use
<a href="https://upgrade.yubico.com/getapikey/" rel="noopener noreferrer" target="_blank">our online API key generator</a>. It will
assign you an ID and create a shared key. You can use the shared key
to authenticate that the API responses do come from Yubico.</p></div>
</div>
<div class="sect2">
<h3 id="_capture_an_otp">Capture an OTP</h3>
<div class="paragraph"><p>Capture an OTP output from your YubiKey. You can do that by opening
a text editor and simply pressing the button on the YubiKey. The OTP is a
simple string of characters, like this:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>vvvvvvcurikvhjcvnlnbecbkubjvuittbifhndhn</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_validate_otp_format">Validate OTP format</h3>
<div class="paragraph"><p>Prudent clients should validate the data entered by the user so that
it is what the software expects.  YubiKey OTPs consists of 32-48
characters in the ModHex alphabet <code>cbdefghijklnrtuv</code>.  Unfortunately,
this has turned out to be over-aggresive because if the keyboard layout is
Dvorak-based, it will look differently.  For example, the modhex
alphabet in the US Dvorak layout is <code>jxe.uidchtnbpygk</code>.  There are
other Dvorak layouts as well.  For this reason, our recommendation is
that clients only check that the input consists of 32-48 printable
characters.</p></div>
</div>
<div class="sect2">
<h3 id="_send_otp_to_our_server">Send OTP to our server</h3>
<div class="paragraph"><p>Send the authentication request to our servers following the protocol
specified below. Your request should include the verifier ID (a number
that identifies the signature key), the OTP you captured in the
previous instruction, and a random looking string of characters to
make the request unique. The request is part of the HTTP GET URL,
encoded using normal parameter/value pairs. For example (broken into
two lines for legibility):</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>https://api2.yubico.com/wsapi/2.0/verify?id=1&amp;otp=cccccccbcjdifc\
trndncchkftchjlnbhvhtugdljibej&amp;nonce=aef3a7835277a28da831005c2ae3b919e2076a62</pre>
</div></div>
<div class="paragraph"><p>The servers that Yubico provides are:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>api.yubico.com
api2.yubico.com
api3.yubico.com
api4.yubico.com
api5.yubico.com</pre>
</div></div>
<div class="paragraph"><p>These servers are hosted in different places and by different organizations.</p></div>
<div class="paragraph"><p>Clients should send authentication requests to all of them in parallel, and
utilize the first response received for added reliability should one or more
of the api servers be offline, see <a href="https://github.com/Yubico/yubico-c-client" rel="noopener noreferrer" target="_blank">Yubico C client</a> for technical details.</p></div>
</div>
<div class="sect2">
<h3 id="_parse_response">Parse response</h3>
<div class="paragraph"><p>You will recieve a response back from the server, a string of text
that resembles the following:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>h=vjhFxZrNHB5CjI6vhuSeF2n46a8=
t=2010-04-23T20:34:51Z0678
otp=cccccccbcjdifctrndncchkftchjlnbhvhtugdljibej
nonce=aef3a7835277a28da831005c2ae3b919e2076a62
sl=75
status=OK</pre>
</div></div>
<div class="paragraph"><p>You can check the authenticity of this response by checking that the
OTP and nonce was the same as the one you requested validation for and
verify the HMAC-SHA-1 signature.</p></div>
</div>
<div class="sect2">
<h3 id="_make_a_decision">Make a decision</h3>
<div class="paragraph"><p>Use the <code>status=</code> codes to make a decision whether to authenticate
your user or not. All the status codes and their meanings are
described by the protocol specification, see below.</p></div>
</div>
<div class="sect2">
<h3 id="_binding_an_otp_to_an_identity">Binding an OTP to an Identity</h3>
<div class="paragraph"><p>Since a valid OTP on its own is not terribly useful, you need to
connect it to a user in some way.  This is normally not something the
client needs to do, it belongs elsewhere in the application, however
for completeness we mention how it is done here.</p></div>
<div class="paragraph"><p>In some situations, the user is typing her username directly into your
application, which solves the issue.</p></div>
<div class="paragraph"><p>More generally, the YubiKey OTP contains as the initial part an
identity of the YubiKey, and it can be used to identify the user.  The
identity part is the same for every OTP, and it is the initial 2-16
modhex characters of the OTP.  (The identity can be programmed to 0
characters, but then obviously this scheme does not apply.)  Since the
rest of the OTP is always 32 characters, the method to extract the
identity is to remove 32 characters from the end and then use the
remaining string, which should be 2-16 characters, as the YubiKey
identity.</p></div>
<div class="paragraph"><p>Note that the validation server is case sensitive, so you need to
lower-case the string in order to avoid caps lock resulting in
different identities with the only differ being case of the prefix.</p></div>
<div class="paragraph"><p>Typically you would store the association between the user and the
YubiKey prefix in a database.</p></div>
</div>
<div class="sect2">
<h3 id="_the_end">The End</h3>
<div class="paragraph"><p>There are some more subtle matters that can be important, so please
read the entire protocol specification for all the details.</p></div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>