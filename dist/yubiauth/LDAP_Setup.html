<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>LDAP Setup</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li><a href="/yubiauth">yubiauth</a></li>
<li class="active">LDAP Setup</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/yubiauth">yubiauth</a><ul class="">
<li><a href="/yubiauth/Release_Notes.html">Release Notes</a></li>
<li class="active"><a href="/yubiauth/LDAP_Setup.html">LDAP Setup</a>
<li><a href="/yubiauth/REST_API.html">REST API</a></li>
<li><a href="/yubiauth/YubiHSM_Setup.html">YubiHSM Setup</a></li>
</li></ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/yubiauth" rel="noopener noreferrer" target="_blank"><i class="fa fa-github fa-lg"></i> Github</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_ldap_setup">LDAP Setup</h1>
<div class="sectionbody">
<div class="paragraph"><p>If you already have an external user database which can be used to authenticate
users over LDAP, you may use this with YubiAuth instead of the built-in
password system. When LDAP password validation is used, local password
validation will be disabled, and each time a user attempts to log in the
request will be delegated to the LDAP server. Any user that does not exist in
the LDAP database will not be able to log in.</p></div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph"><p>To enable LDAP you will need to modify the configuration file, located here:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>/etc/yubico/auth/yubiauth.conf</pre>
</div></div>
<div class="paragraph"><p>First off, find the USE_LDAP setting, and change it to True:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>USE_LDAP = True</pre>
</div></div>
<div class="paragraph"><p>There are two more settings that are required to make things work. These are
set as follows:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LDAP_SERVER = '&lt;LDAP server URL&gt;'</pre>
</div></div>
<div class="paragraph"><p>This is the URL to the LDAP server to use for password authentication. The
format for this is defined in <a href="http://www.ietf.org/rfc/rfc4516.txt" rel="noopener noreferrer" target="_blank">RFC 4516</a>.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LDAP_BIND_DN = '&lt;template for Bind DN&gt;'</pre>
</div></div>
<div class="paragraph"><p>This is a template for the Bind DN used to authenticate a user. The template
string is passed the User object when performing authentication, and uses
Pythons <a href="http://docs.python.org/2/library/string.html#formatstrings" rel="noopener noreferrer" target="_blank">string.format</a>
function to format the string. The User object is passed as "user".
For example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LDAP_BIND_DN = 'uid={user.name},ou=People,dc=example,com'</pre>
</div></div>
<div class="paragraph"><p>If the user "Bob" tries to log in, the above template expands to:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>uid=Bob,ou=People,dc=example,com</pre>
</div></div>
<div class="paragraph"><p>Note that while {user.name} can always be used to expand to the username,
relying on other attributes may require that the user already exist in the
YubiAuth database to work.</p></div>
<div class="paragraph"><p>Note that what is needed to authenticate the user here is the fully qualified
DN, which might not include the actual username of the user. To connect a user
of with an arbitrary username to a specific LDAP user, you can either use other
user attributes in the template, or use the special attribute "_ldap_bind_dn"
attribute which will override the LDAP_BIND_DN on a user level.</p></div>
<div class="paragraph"><p>Finally, there is an LDAP_AUTO_IMPORT setting which will automatically create
a user in the YubiAuth database if the user tries to log in while LDAP is being
used, and the user does not already exist in YubiAuth. This is only done once
the password has been verified against the LDAP server.</p></div>
<div class="paragraph"><p>For example, if the user "johndoe" tries to log in with the password "letmein",
YubiAuth will query the LDAP server, and if authentication is successful, the
"johndoe" user will be created in YubiAuth, so that YubiKeys may be associated
with the account. If the LDAP_AUTO_IMPORT setting is turned off, then the login
request will fail.</p></div>
</div>
<div class="sect2">
<h3 id="_active_directory">Active Directory</h3>
<div class="paragraph"><p>If you use Active Directory you can find out what the Bind DN should be by
doing the following:</p></div>
<div class="paragraph"><p>On the Windows Server, open a command prompt. Run the command:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>dsquery user -name &lt;username&gt;</pre>
</div></div>
<div class="paragraph"><p>This will list the correct Bind DB to use for the user &lt;username&gt; (you can use
a * instead of a real username and all users will be printed):</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>"CN=user1,CN=Users,DC=example,DC=com"</pre>
</div></div>
<div class="paragraph"><p>In the above case, the Bind DN would then be set to:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LDAP_BIND_DN = 'CN={user.name},CN=Users,DC=example,DC=com'</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_final_steps">Final steps</h3>
<div class="paragraph"><p>Everything should now be configured correctly. You will need to restart your
web server for the changes to take effect.</p></div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>