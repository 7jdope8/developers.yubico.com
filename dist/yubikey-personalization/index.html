<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>yubikey-personalization</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li class="active">yubikey-personalization</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/yubikey-personalization">yubikey-personalization</a><ul class="">
<li><a href="/yubikey-personalization/Release_Notes.html">Release Notes</a></li>
<li><a href="/yubikey-personalization/Compatibility.html">Compatibility</a></li>
<li><a href="/yubikey-personalization/USB-Hid-Issue.html">USB-Hid-Issue</a></li>
</ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/yubikey-personalization" rel="noopener noreferrer" target="_blank"><i class="fa fa-github fa-lg"></i> Github</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_yubikey_personalization">Yubikey Personalization</h1>
<div class="sectionbody">
<div class="paragraph"><p>The YubiKey Personalization package contains a library and command
line tool used to personalize (i.e., set a AES key) YubiKeys.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation">Documentation</h2>
<div class="sectionbody">
<div class="paragraph"><p>The complete reference manual on the YubiKey is required reading if
you want to understand the entire picture and what each parameter
does.  Download it from <a href="http://www.yubico.com/" rel="noopener noreferrer" target="_blank">http://www.yubico.com/</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_dependencies">Dependencies</h2>
<div class="sectionbody">
<div class="paragraph"><p>Getting and installing dependencies depends on your operating systems,
we give example for some flavours.  If you know how to install
dependencies on other systems, let us know.  Debian hints should apply
to Debian derivatives as well, including Ubuntu.</p></div>
<div class="paragraph"><p>Yubico-c is needed, see: <a href="https://developers.yubico.com/yubico-c/">https://developers.yubico.com/yubico-c/</a></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Debian:           apt-get install libyubikey-dev
Fedora:           dnf install libyubikey-devel</pre>
</div></div>
<div class="paragraph"><p>Pkg-config simplify finding other dependencies, see:
<a href="http://www.freedesktop.org/wiki/Software/pkg-config" rel="noopener noreferrer" target="_blank">http://www.freedesktop.org/wiki/Software/pkg-config</a></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Debian:           apt-get install pkg-config</pre>
</div></div>
<div class="paragraph"><p>Yubikey-personalization depends on libusb or libusb-1, so you will
have to get it.  We recommend using libusb-1.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Debian libusb-1:  apt-get install libusb-1.0-0-dev
Debian libusb:    apt-get install libusb-dev
Fedora:           dnf install libusb-devel</pre>
</div></div>
<div class="paragraph"><p>The JSON library is an optional dependency, see:
<a href="https://github.com/json-c/json-c/wiki" rel="noopener noreferrer" target="_blank">https://github.com/json-c/json-c/wiki</a></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Debian:           apt-get install libjson-c-dev</pre>
</div></div>
<div class="paragraph"><p>You need json-c version 0.10 or later to get pretty printing of JSON
output.  This project will build with version 0.9 too, but will not
pretty print the JSON output.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_license">License</h2>
<div class="sectionbody">
<div class="paragraph"><p>The project is licensed under a BSD license.  See the file COPYING for
exact wording.  For any copyright year range specified as YYYY-ZZZZ in
this package note that the range specifies every single year in that
closed interval.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_building_from_git">Building from Git</h2>
<div class="sectionbody">
<div class="paragraph"><p>Skip to the next section if you are using an official packaged
version.</p></div>
<div class="paragraph"><p>You may check out the sources using Git with the following command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>  git clone https://github.com/Yubico/yubikey-personalization.git</pre>
</div></div>
<div class="paragraph"><p>This will create a directory <em>yubikey-personalization</em>.  Enter the directory:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>  cd yubikey-personalization</pre>
</div></div>
<div class="paragraph"><p>When building from source Yubikey-personalization depends on <a href="http://asciidoc.org/INSTALL.html" rel="noopener noreferrer" target="_blank">asciidoc</a>, xsltproc and DocBook to build its manpage.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>  Debian:           apt-get install asciidoc xsltproc docbook-xsl</pre>
</div></div>
<div class="paragraph"><p>Autoconf, automake and libtool must be installed.</p></div>
<div class="paragraph"><p>Generate the build system using:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>  autoreconf --install</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_building">Building</h2>
<div class="sectionbody">
<div class="paragraph"><p>The build system uses Autoconf, to set up the build system run:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>  ./configure</pre>
</div></div>
<div class="paragraph"><p>Then build the code, run the self-test and install the binaries:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>  make check install</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_using">Using</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">By using this tool you will destroy the AES key in your
YubiKey.  This prevents it from being useful against Yubicoâ€™s
validation server.  It is possible to upload a new AES key to Yubico,
using a random YubiKey prefix, to restore it.  But it is not possible
to get back your old yubikey prefix if you decide to re-program your
YubiKey.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">When running any of the utils that need to access the YubiKey
you will either need to run as root, or you will have to have made sure
that the current user has permission to access the device. These
permissions can be set up by copying the udev rules files
(<a href="https://github.com/Yubico/yubikey-personalization/blob/master/69-yubikey.rules" rel="noopener noreferrer" target="_blank">69-yubikey.rules</a>
and <a href="https://github.com/Yubico/yubikey-personalization/blob/master/70-yubikey.rules" rel="noopener noreferrer" target="_blank">70-yubikey.rules</a>) to /etc/udev/rules.d/</td>
</tr></table>
</div>
<div class="paragraph"><p>With that out of the way, here is how you would program a YubiKey with
an all-zero AES key and a dummy prefix:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>./ykpersonalize -1 -ofixed=cccccccccccc -a00000000000000000000000000000000
Firmware version 1.3.1 Touch level 9840 Program sequence 10
Configuration data to be written to key configuration 1:

fixed: m:cccccccccccc
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:000000000000
ticket_flags: APPEND_CR
config_flags:

Commit? (y/n) [n]: y
$
</pre>
</div></div>
<div class="paragraph"><p>Using the "ykparse" tool from the yubico-c package, you can check that
the OTPs are correct.  For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>ykparse 00000000000000000000000000000000 ccccccccccccdkrkedgchtlfefghcekefhlifbchijrd
warning: overlong token, ignoring prefix: cccccccccccc
Input:
  token: dkrkedgchtlfefghcekefhlifbchijrd
          29 c9 32 50 6d a4 34 56 03 93 46 a7 41 06 78 c2
  aeskey: 00000000000000000000000000000000
          00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Output:
          00 00 00 00 00 00 01 00 53 ea 63 00 6f 9e c4 24

Struct:
  uid: 00 00 00 00 00 00
  counter: 1 (0x0001)
  timestamp (low): 59987 (0xea53)
  timestamp (high): 99 (0x63)
  session use: 0 (0x00)
  random: 40559 (0x9e6f)
  crc: 9412 (0x24c4)

Derived:
  cleaned counter: 1 (0x0001)
  modhex uid: cccccccccccc
  triggered by caps lock: no
  crc: F0B8
  crc check: ok
$
</pre>
</div></div>
<div class="paragraph"><p>To program a YubiKey in static mode, you use the -ostatic-ticket flag
as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span> ./ykpersonalize -1 -ofixed=cccccccccccc -a00000000000000000000000000000000 -ostatic-ticket
Firmware version 1.3.1 Touch level 9856 Program sequence 11
Configuration data to be written to key configuration 1:

fixed: m:cccccccccccc
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:000000000000
ticket_flags: APPEND_CR
config_flags: STATIC_TICKET

Commit? (y/n) [n]: y
$
</pre>
</div></div>
<div class="paragraph"><p>To program a YubiKey in static mode with a strongly looking password
(i.e., also containing numeric and upper case letters), you use the
-ostatic-ticket flag together with -ostrong-pw1 and -ostrong-pw2 (note
YubiKey 2.0 only!) as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span> ./ykpersonalize -1 -ofixed=cccccccccccc -a00000000000000000000000000000000 -ostatic-ticket -ostrong-pw1 -ostrong-pw2
Firmware version 2.0.0 Touch level 1792 Program sequence 3
Configuration data to be written to key configuration 1:

fixed: m:cccccccccccc
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:000000000000
ticket_flags: APPEND_CR
config_flags: STATIC_TICKET|STRONG_PW1|STRONG_PW2

Commit? (y/n) [n]: y
$
</pre>
</div></div>
<div class="paragraph"><p>Alternatively on a YubiKey 2.0, you can program the second configuration, which
defaults to be the static key configuration:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span> ./ykpersonalize -2 -ofixed=cccccccccccc -a00000000000000000000000000000000
Firmware version 2.0.0 Touch level 1792 Program sequence 3
Configuration data to be written to key configuration 2:

fixed: m:cccccccccccc
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:000000000000
ticket_flags: APPEND_CR
config_flags: STATIC_TICKET|STRONG_PW1|STRONG_PW2

Commit? (y/n) [n]: y
$
</pre>
</div></div>
<div class="paragraph"><p>To program a YubiKey with a lock code (to prevent others from easily
reprogramming it), you use the -oaccess= flag as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>./ykpersonalize -1 -ofixed=vvvecdcedvjj -a00000000000000000000000000000000 -oaccess=001100001100
Firmware version 2.0.0 Touch level 1792 Program sequence 3
Configuration data to be written to key configuration 1:

fixed: m:vvvecdcedvjj
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:001100001100
ticket_flags: APPEND_CR
config_flags:

Commit? (y/n) [n]: y
$
</pre>
</div></div>
<div class="paragraph"><p>To re-program a YubiKey that has a lock code set, you use the
-cXXX.. flag as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>./ykpersonalize -1 -c001100001100 -ofixed=vvvecdcedvjj -a00000000000000000000000000000000 -oaccess=001100223300
Firmware version 2.0.0 Touch level 1792 Program sequence 3
Configuration data to be written to key configuration 1:

fixed: m:vvvecdcedvjj
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:001100223300
ticket_flags: APPEND_CR
config_flags:

Commit? (y/n) [n]: y
$
</pre>
</div></div>
<div class="paragraph"><p>To disable the lock code on a YubiKey, program it with a lock code set
to zeros.  For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>./ykpersonalize -1 -c001100001133 -ofixed=vvvecdcedvjj -a00000000000000000000000000000003 -oaccess=000000000000
Firmware version 2.0.0 Touch level 1792 Program sequence 7
Configuration data to be written to key configuration 1:

fixed: m:vvvecdcedvjj
uid: h:000000000000
key: h:00000000000000000000000000000000
acc_code: h:000000000000
ticket_flags: APPEND_CR
config_flags:

Commit? (y/n) [n]: y
$
</pre>
</div></div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>