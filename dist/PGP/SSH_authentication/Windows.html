<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>Windows</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li class="active"><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li><a href="/PGP">PGP</a></li>
<li><a href="/PGP/SSH_authentication">SSH authentication</a></li>
<li class="active">Windows</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/PGP">PGP</a><ul class="">
<li><a href="/PGP/Importing_keys.html">Importing keys</a></li>
<li><a href="/PGP/Card_edit.html">Card edit</a></li>
<li class="active"><a href="/PGP/SSH_authentication">SSH authentication</a><ul class="">
<li class="active"><a href="/PGP/SSH_authentication/Windows.html">Windows</a>
</li></ul>
<li><a href="/PGP/Git_signing.html">Git signing</a></li>
</li></ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul></ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_ssh_authentication_using_a_yubikey_on_windows">SSH authentication using a YubiKey on Windows</h1>
<div class="sectionbody">
<div class="paragraph"><p>The YubiKey 4 and YubiKey NEO support the OpenPGP interface for smart cards
which can be used with GPG4Win for encryption and signing, as well as for SSH
authentication. These in turn can be used by several other useful tools, like
Git, pass, etc. This guide will help you set up the required software for
getting things to work.</p></div>
<div class="sect2">
<h3 id="_gpg4win">GPG4Win</h3>
<div class="paragraph"><p>First things first. The core of everything is <a href="https://www.gpg4win.org/" rel="noopener noreferrer" target="_blank">GPG4Win</a>.
Install the latest version. You will also need to autostart
gpg-connect-agent.exe (which comes with GPG4Win) when your computer starts. You
can do this by creating a shortcut to <code>"C:\Program Files
(x86)\GNU\GnuPG\gpg-connect-agent.exe" /bye</code> and placing it in your <em>Startup</em>
program group in your Start menu. Changing the <em>Run:</em> setting from <em>Normal
window</em> to <em>Minimized</em> makes it slightly less obtrusive at login.</p></div>
<div class="paragraph"><p>If you haven’t already, you will need to setup a PGP key on your NEO.</p></div>
<div class="paragraph"><p>GPG4Win’s smart card support is not rock solid; occasionally you might get
error messages when trying to access the YubiKey. It might happen after
removing and re-inserting the YubiKey, or after your computer has been in sleep
mode, etc. This can be resolved by restarting gpg-agent using the following
commands:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>gpg-connect-agent killagent /bye
<span class="sh-dollar"></span>gpg-connect-agent /bye
</pre>
</div></div>
<div class="paragraph"><p>You might want to put these commands in a BAT-file for quick access.</p></div>
</div>
<div class="sect2">
<h3 id="_enable_ssh_authentication">Enable SSH authentication</h3>
<div class="paragraph"><p>GPG4Win has support for SSH authentication built-in, which is compatible with
the Pageant protocol used by PuTTY. By enabling this support GPG4Win can act as
a drop-in replacement for Pageant. Enabling this is done by creating (or
editing) the gpg-agent.conf file and adding the following line to it:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>enable-putty-support</pre>
</div></div>
<div class="paragraph"><p>The file is found in the gnupg directory: <code>%APPDATA%\gnupg\</code> (at least on
Windows 10). The gpg-agent will need to be restarted (as described in the
previous section) for this change to take effect. Once enabled, any application
which supports SSH authentication using Pageant should "just work".</p></div>
</div>
<div class="sect2">
<h3 id="_putty">PuTTY</h3>
<div class="paragraph"><p>If you’ve installed GPG4Win and enabled PuTTY support, then PuTTY should work
out of the box. You can download and install PuTTY
<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" rel="noopener noreferrer" target="_blank">here</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_git">Git</h3>
<div class="paragraph"><p>For Git there are two options. Either install Cygwin and use Git from within
that shell, or install <a href="https://git-scm.com/download/win" rel="noopener noreferrer" target="_blank">Git for Windows</a>. The
first approach might be desirable if you’re planning on using Cygwin anyway. If
so, just add Git to the packages to install when installing Cygwin. During the
installation you will be asked if you prefer to use <strong>OpenSSH (recommended)</strong> or
<strong>PuTTY</strong>. As we wish to use GPG4Win for SSH authentication you need to select
PuTTY.</p></div>
</div>
<div class="sect2">
<h3 id="_cygwin">Cygwin</h3>
<div class="paragraph"><p><a href="https://cygwin.com/install.html" rel="noopener noreferrer" target="_blank">Cygwin</a> provides a Unix-like terminal with
several useful tools, like Git, SSH, and so on..  It is recommended to keep the
installer around, as it can be re-run to add or remove packages from Cygwin.
During installation, you will be asked which packages to install. Make sure to
not install gpg, as we wish to use the already installed GPG4Win. Do make sure
to install ssh-pageant to allow the included ssh client to use the NEO for
authentication. Once installed, open a Cygwin shell and edit the ~/.bashrc file
adding the following to the bottom:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># ssh-pageant #
eval $(/usr/bin/ssh-pageant -r -a "/tmp/.ssh-pageant-$USERNAME")</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_pass">Pass</h3>
<div class="paragraph"><p>Pass is a lightweight command-line password manager that uses GPG for
encrypting data, and Git for version control and distribution. It requires
Cygwin to run on Windows, as well as the following packages for Cygwin (re-run
the installer to select these if they are not already installed): make and
tree. With those additional packages installed, download the source
distribution (tarball) of the latest release of pass from
<a href="https://www.passwordstore.org/" rel="noopener noreferrer" target="_blank">here</a>. Using a Cygwin terminal, extract the
archive using the command: <code>tar xfa &lt;filename&gt;.tar.xz</code> Change into the
extracted directory and run: make install If the installation didn’t install
the bash-completion file, do so manually by running: <code>cp
src/completion/pass.bash-completion /etc/bash_completion.d/pass</code></p></div>
</div>
<div class="sect2">
<h3 id="_misc">Misc</h3>
<div class="paragraph"><p>Bash completion for gpg might be broken under cygwin due to GPG4Win outputting
carriage returns in its --dump-options command (which shows up as <code>^M</code> after each
completed command). This can be fixed by editing <code>/etc/bash_completion.d/gpg</code>
and adding <code>| sed "s/\r$//"</code> after the gpg --dump-options command.</p></div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>