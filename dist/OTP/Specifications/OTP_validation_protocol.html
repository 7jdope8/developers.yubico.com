<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>OTP validation protocol</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li class="active"><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li><a href="/OTP">OTP</a></li>
<li><a href="/OTP/Specifications">Specifications</a></li>
<li class="active">OTP validation protocol</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/OTP">OTP</a><ul class="">
<li><a href="/OTP/Plugins.html">Plugins</a></li>
<li><a href="/OTP/Libraries">Libraries</a></li>
<li><a href="/OTP/OTPs_Explained.html">OTPs Explained</a></li>
<li><a href="/OTP/Guides">Guides</a></li>
<li><a href="/OTP/Modhex_Converter.html">Modhex Converter</a></li>
<li class="active"><a href="/OTP/Specifications">Specifications</a><ul class="">
<li><a href="/OTP/Specifications/OTP_decryption_protocol.html">OTP decryption protocol</a></li>
<li class="active"><a href="/OTP/Specifications/OTP_validation_protocol.html">OTP validation protocol</a>
<li><a href="/OTP/Specifications/Test_vectors.html">Test vectors</a></li>
</li></ul>
</li></ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul></ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_validation_protocol_version_2_0">Validation Protocol Version 2.0</h1>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph"><p>All requests are HTTP GET requests. As such, all parameters must be
properly URL encoded.  In particular, some base64 characters (such as
"+") in the value fields needs to be escaped.</p></div>
<div class="paragraph"><p>Each response sent by the server is signed.  To verify that the
response has not been tampered with, clients either verify the HMAC
signature or use HTTPS connections (and verify the server
certificate).</p></div>
</div>
<div class="sect2">
<h3 id="_generating_signatures">Generating signatures</h3>
<div class="paragraph"><p>The protocol uses HMAC-SHA-1 signatures. The HMAC key to use is the
client API key.</p></div>
<div class="paragraph"><p>Generate the signature over the parameters in the message.  Each
message contains a set of key/value pairs, and the signature is always
over the entire set (excluding the signature itself), and sorted in
alphabetical order of the keys. More precisely, to generate a message
signature do:</p></div>
<div class="ulist"><ul>
<li>
<p>
Alphabetically sort the set of key/value pairs by key order.
</p>
</li>
<li>
<p>
Construct a single line with each ordered key/value pair concatenated using <em>&amp;</em>, and each key and value contatenated with <em>=</em>. Do not add any linebreaks. Do not add whitespace. For example: <code>a=2&amp;b=1&amp;c=3</code>.
</p>
</li>
<li>
<p>
Apply the HMAC-SHA-1 algorithm on the line as an octet string using the API key as key (remember to base64decode the API key obtained from Yubico).
</p>
</li>
<li>
<p>
Base 64 encode the resulting value according to RFC 4648, for example, <code>t2ZMtKeValdA+H0jVpj3LIichn4=</code>.
</p>
</li>
<li>
<p>
Append the value under key <em>h</em> to the message.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_verifying_signatures">Verifying signatures</h3>
<div class="paragraph"><p>To verify a signature on a response message, follow the same procedure
that was used to sign the response message and compare the signature
in the response to the signature you generated.  If the signature
values are equal, the signature is correct.  Make sure you remove the
signature itself from the values you generate the signature over for
verification. If the incoming message is</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>b=1&amp;a=2&amp;c=3&amp;h=V5FkMYr9GCG9tQA9ihuuybWl99U=</pre>
</div></div>
<div class="paragraph"><p>make sure to remove h before verifying:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>b=1&amp;a=2&amp;c=3</pre>
</div></div>
<div class="paragraph"><p>Don’t forget to sort the key/value pairs.</p></div>
</div>
<div class="sect2">
<h3 id="_verification">Verification</h3>
<div class="paragraph"><p>There is one call to verify YubiKey OTPs: verify.</p></div>
<div class="paragraph"><p>The verify call lets you check whether an OTP is valid.  Since the OTP
itself contains identification information, all you have to do is to
send the OTP.</p></div>
<div class="paragraph"><p>To avoid cut’n'paste attacks, the client MUST verify that the "otp" in
the response is the same as the "otp" supplied in the request.</p></div>
</div>
<div class="sect2">
<h3 id="_request">Request</h3>
<div class="paragraph"><p>Construct an HTTP GET call to</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>https://api.yubico.com/wsapi/2.0/verify</pre>
</div></div>
<div class="paragraph"><p>with the following parameters (note that this request need not be signed):</p></div>
<table class="table table-bordered table-striped tableblock frame-all grid-all" style="
width:100%;
">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top"> parameter </th>
<th class="tableblock halign-left valign-top"> type </th>
<th class="tableblock halign-left valign-top"> required </th>
<th class="tableblock halign-left valign-top"> purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the requestor so that the end-point can retrieve correct shared secret for signing the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">otp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OTP from the YubiKey.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional HMAC-SHA1 signature for the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp=1 requests timestamp and session counter information in the response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A 16 to 40 character long string with random unique data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value 0 to 100 indicating percentage of syncing required by client, or strings "fast" or "secure" to use server-configured values; if absent, let the server decide</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds to wait for sync responses; if absent, let the server decide</p></td>
</tr>
</tbody>
</col></col></col></col></table>
<div class="paragraph"><p>An example request:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>https://api.yubico.com/wsapi/2.0/verify?otp=vvvvvvcucrlcietctckflvnncdgckubflugerlnr&amp;id=87&amp;timeout=8&amp;sl=50&amp;nonce=askjdnkajsndjkasndkjsnad</pre>
</div></div>
<div class="paragraph"><p>And if you require additional information on timestamp and session
counters:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>https://api.yubico.com/wsapi/2.0/verify?id=87&amp;otp=vvvvvvcucrlcietctckflvnncdgckubflugerlnr&amp;timeout=8&amp;sl=50&amp;nonce=askjdnkajsndjkasndkjsnad&amp;timestamp=1</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_response">Response</h3>
<div class="paragraph"><p>The verification response tells you whether the OTP is valid.  The
response has the following values:</p></div>
<table class="table table-bordered table-striped tableblock frame-all grid-all" style="
width:100%;
">
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter </th>
<th class="tableblock halign-left valign-top"> type </th>
<th class="tableblock halign-left valign-top"> purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">otp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OTP from the YubiKey, from request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random unique data, from request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (base64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature as described above.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time stamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp in UTC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the operation, see below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">YubiKey internal timestamp value when key was pressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessioncounter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">YubiKey internal usage counter when key was pressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionuse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">YubiKey internal session usage counter when key was pressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percentage of external validation server that replied successfully (0 to 100)</p></td>
</tr>
</tbody>
</col></col></col></table>
<div class="paragraph"><p>These are the possible "status" values in a verify response:</p></div>
<table class="table table-bordered table-striped tableblock frame-all grid-all" style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top"> name </th>
<th class="tableblock halign-left valign-top"> meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OTP is valid.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_OTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OTP is invalid format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REPLAYED_OTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OTP has already been seen by the service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAD_SIGNATURE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HMAC signature verification failed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MISSING_PARAMETER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request lacks a parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NO_SUCH_CLIENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request id does not exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPERATION_NOT_ALLOWED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request id is not allowed to verify OTPs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BACKEND_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unexpected error in our server. Please contact us if you see this error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT_ENOUGH_ANSWERS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server could not get requested number of syncs during before timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REPLAYED_REQUEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server has seen the OTP/Nonce combination before</p></td>
</tr>
</tbody>
</col></col></table>
</div>
<div class="sect2">
<h3 id="_changes_since_version_1_1">Changes since version 1.1</h3>
<div class="paragraph"><p>The verify URL has changed.  In the request, the new required field
"nonce" were added, and the new optional fields "sl" and "timeout" are
added.  In the response, the new fields "otp", "nonce", and "sl" are
added.  The status codes NOT_ENOUGH_ANSWERS and REPLAYED_REQUEST were
added.</p></div>
<div class="paragraph"><p>Since both the URL and required fields has changed, version 2.0 is not
backwards compatible with version 1.1 or version 1.0.  However,
because version 2.0 use a different URL than version 1.x, the server
may support both version 1.x and version 2.0 clients at the same time.</p></div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>