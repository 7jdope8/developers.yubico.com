<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>python-yubihsm</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li class="active">python-yubihsm</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/python-yubihsm">python-yubihsm</a><ul class="">
<li><a href="/python-yubihsm/Release_Notes.html">Release Notes</a></li>
<li><a href="/python-yubihsm/API_Documentation">API Documentation</a></li>
</ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/python-yubihsm" rel="noopener noreferrer" target="_blank"><i class="fa fa-github fa-lg"></i> Github</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_python_yubihsm">python-yubihsm</h1>
<div class="sectionbody">
<div class="paragraph"><p>Python library and tests for the YubiHSM 2.
This library is compatible with both Python 2 and 3.</p></div>
<div class="paragraph"><p>This libary communicates with the YubiHSM 2 connector daemon, which must already be running.
It can also communicate directly with the YubiHSM 2 via USB.</p></div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="literalblock">
<div class="content monospaced">
<pre>Copyright 2018 Yubico AB

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph"><p>From PyPI:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pip install yubihsm[http,usb]
</pre>
</div></div>
<div class="paragraph"><p>From a source .tar.gz:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pip install yubihsm-&lt;version&gt;.tar.gz[http,usb]
</pre>
</div></div>
<div class="paragraph"><p>Omitting a tag from the brackets will install the library without support for
that backend, and will avoid installing unneeded dependencies.</p></div>
</div>
<div class="sect2">
<h3 id="_quick_reference_commands">Quick reference commands:</h3>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yubihsm</span> <span class="kn">import</span> <span class="n">YubiHsm</span>
<span class="kn">from</span> <span class="nn">yubihsm.defs</span> <span class="kn">import</span> <span class="n">CAPABILITY</span><span class="p">,</span> <span class="n">ALGORITHM</span>
<span class="kn">from</span> <span class="nn">yubihsm.objects</span> <span class="kn">import</span> <span class="n">AsymmetricKey</span>

<span class="c1"># Connect to the YubiHSM via the connector using the default password:</span>
<span class="n">hsm</span> <span class="o">=</span> <span class="n">YubiHsm</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'http://localhost:12345'</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">hsm</span><span class="o">.</span><span class="n">create_session_derived</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">)</span>

<span class="c1"># Generate a private key on the YubiHSM for creating signatures:</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">AsymmetricKey</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>  <span class="c1"># Generate a new key object in the YubiHSM.</span>
    <span class="n">session</span><span class="p">,</span>                   <span class="c1"># Secure YubiHsm session to use.</span>
    <span class="mi">0</span><span class="p">,</span>                         <span class="c1"># Object ID, 0 to get one assigned.</span>
    <span class="s1">'My key'</span><span class="p">,</span>                  <span class="c1"># Label for the object.</span>
    <span class="mi">1</span><span class="p">,</span>                         <span class="c1"># Domain(s) for the object.</span>
    <span class="n">CAPABILITY</span><span class="o">.</span><span class="n">SIGN_ECDSA</span><span class="p">,</span>     <span class="c1"># Capabilities for the ojbect.</span>
    <span class="n">ALGORITHM</span><span class="o">.</span><span class="n">EC_P256</span>          <span class="c1"># Algorithm for the key.</span>
<span class="p">)</span>

<span class="c1"># pub_key is a cryptography.io ec.PublicKey, see https://cryptography.io</span>
<span class="n">pub_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">get_public_key</span><span class="p">()</span>

<span class="c1"># Write the public key to a file:</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'public_key.pem'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pub_key</span><span class="o">.</span><span class="n">public_bytes</span><span class="p">(</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">Encoding</span><span class="o">.</span><span class="n">PEM</span><span class="p">,</span>
        <span class="n">format</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">PublicFormat</span><span class="o">.</span><span class="n">SubjectPublicKeyInfo</span>
    <span class="p">))</span>

<span class="c1"># Sign some data:</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">sign_ecdsa</span><span class="p">(</span><span class="sa">b</span><span class="s1">'Hello world!'</span><span class="p">)</span>  <span class="c1"># Create a signature.</span>

<span class="c1"># Clean up</span>
<span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">hsm</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_development">Development</h3>
<div class="paragraph"><p>For development of the library, we recommend using <code>pipenv</code>. To set up the dev
environment, run this command in the root directory of the repository:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pipenv install --dev
</pre>
</div></div>
<div class="sect3">
<h4 id="_running_tests">Running tests</h4>
<div class="paragraph"><p>Running the tests require a YubiHSM 2 to run against, with the default
authentication key set.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">The YubiHSM under test will be factory reset by the tests!</td>
</tr></table>
</div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pipenv run test
</pre>
</div></div>
<div class="paragraph"><p>You can specify a specific module or test to run by using the -s flag:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pipenv run test -s test.device.test_ec
</pre>
</div></div>
<div class="paragraph"><p>By default the tests will connect to a yubihsm-connector running with the
default settings on <a href="http://localhost:12345" rel="noopener noreferrer" target="_blank">http://localhost:12345</a>. To change this, use the <code>BACKEND</code>
variable, eg:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>BACKEND="yhusb://" pipenv run python setup.py test
</pre>
</div></div>
<div class="paragraph"><p>Access to the device requires proper permissions, so either use sudo or setup a
udev rule.</p></div>
</div>
<div class="sect3">
<h4 id="_generating_html_documentation">Generating HTML documentation</h4>
<div class="paragraph"><p>To build the HTML documentation, run:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pipenv run docs
</pre>
</div></div>
<div class="paragraph"><p>The resulting output will be in docs/_build/html/.</p></div>
</div>
<div class="sect3">
<h4 id="_source_releases_for_distribution">Source releases for distribution</h4>
<div class="paragraph"><p>Build a source release:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pipenv run python setup.py sdist
</pre>
</div></div>
<div class="paragraph"><p>The resulting .tar.gz will be created in <code>dist/</code>.</p></div>
</div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>