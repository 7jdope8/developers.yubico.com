<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>Using a library</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li class="active"><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li><a href="/FIDO2">FIDO2</a></li>
<li><a href="/FIDO2/Libraries">Libraries</a></li>
<li class="active">Using a library</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/FIDO2">FIDO2</a><ul class="">
<li><a href="/FIDO2/FIDO2_WebAuthn_Developer_Guide">FIDO2 WebAuthn Developer Guide</a></li>
<li class="active"><a href="/FIDO2/Libraries">Libraries</a><ul class="">
<li class="active"><a href="/FIDO2/Libraries/Using_a_library.html">Using a library</a>
<li><a href="/FIDO2/Libraries/List_of_libraries.html">List of libraries</a></li>
</li></ul>
</li></ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/developers.yubico.com/issues/new?title=Suggested%20edit%20for%20FIDO2/Libraries/Using_a_library" rel="noopener noreferrer" target="_blank"><i class="fa fa-pencil-square-o fa-lg"></i> Suggest Edits</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_using_a_fido2_library">Using a FIDO2 library</h1>
<div class="sectionbody">
<div class="paragraph"><p>Let us have a look at the FIDO2 authentication sequence diagram:</p></div>
<div class="imageblock mscgen">
<div class="content">
<img alt="Using_a_library__1.png" src="Using_a_library__1.png">
</img></div>
</div>
<div class="paragraph"><p>The blue part is handled by the WebAuthn client (e.g. the web browser) and the green parts are handled by the FIDO2 server library.</p></div>
<div class="sect2">
<h3 id="_server_side">Server-side</h3>
<div class="paragraph"><p>A server-side FIDO2 library has 4 basic functions: <em>Start registration, Finish registration, Start authentication</em> and <em>Finish authentication</em>.
Below is an example of how these functions can be used in a web server:</p></div>
<div class="sect3">
<h4 id="_registration">Registration</h4>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="c1">// handles HTTPS requests to /register</span>
<span class="kd">public</span> <span class="n">Either</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">RegistrationRequest</span><span class="o">&gt;</span> <span class="nf">startRegistration</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">displayName</span><span class="o">,</span> <span class="n">String</span> <span class="n">credentialNickname</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">userStorage</span><span class="o">.</span><span class="na">getRegistrationsByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">).</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">challengeGenerator</span><span class="o">.</span><span class="na">generateChallenge</span><span class="o">();</span>

      <span class="n">RegistrationRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegistrationRequest</span><span class="o">(</span>
          <span class="n">username</span><span class="o">,</span>
          <span class="n">credentialNickname</span><span class="o">,</span>
          <span class="n">U2fB64Encoding</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">challengeGenerator</span><span class="o">.</span><span class="na">generateChallenge</span><span class="o">()),</span>
          <span class="n">rp</span><span class="o">.</span><span class="na">startRegistration</span><span class="o">(</span>
              <span class="k">new</span> <span class="n">UserIdentity</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">displayName</span><span class="o">,</span> <span class="n">userId</span><span class="o">,</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
              <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">userStorage</span><span class="o">.</span><span class="na">getCredentialIdsForUsername</span><span class="o">(</span><span class="n">username</span><span class="o">)),</span>
              <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">()</span>
          <span class="o">)</span>
      <span class="o">);</span>
      <span class="n">registerRequestStorage</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">(),</span> <span class="n">request</span><span class="o">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">Right</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">Left</span><span class="o">(</span><span class="s">"The username \""</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"\" is already registered."</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="c1">// handles HTTPS requests to /register/finish</span>
<span class="kd">public</span> <span class="n">Either</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;,</span> <span class="n">SuccessfulRegistrationResult</span><span class="o">&gt;</span> <span class="nf">finishRegistration</span><span class="o">(</span><span class="n">String</span> <span class="n">responseJson</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">RegistrationResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">...</span>
      <span class="n">response</span> <span class="o">=</span> <span class="n">jsonMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">responseJson</span><span class="o">,</span> <span class="n">RegistrationResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">...</span>

  <span class="n">RegistrationRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">registerRequestStorage</span><span class="o">.</span><span class="na">getIfPresent</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">());</span>
  <span class="n">registerRequestStorage</span><span class="o">.</span><span class="na">invalidate</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">());</span>

  <span class="o">...</span>
      <span class="n">Try</span><span class="o">&lt;</span><span class="n">RegistrationResult</span><span class="o">&gt;</span> <span class="n">registrationTry</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="na">finishRegistration</span><span class="o">(</span>
          <span class="n">request</span><span class="o">.</span><span class="na">getPublicKeyCredentialCreationOptions</span><span class="o">(),</span>
          <span class="n">response</span><span class="o">.</span><span class="na">getCredential</span><span class="o">(),</span>
          <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">()</span>
      <span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">registrationTry</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">Right</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span>
              <span class="k">new</span> <span class="n">SuccessfulRegistrationResult</span><span class="o">(</span>
                  <span class="n">request</span><span class="o">,</span>
                  <span class="n">response</span><span class="o">,</span>
                  <span class="n">addRegistration</span><span class="o">(</span>
                      <span class="n">request</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span>
                      <span class="n">request</span><span class="o">.</span><span class="na">getPublicKeyCredentialCreationOptions</span><span class="o">().</span><span class="na">user</span><span class="o">(),</span>
                      <span class="n">request</span><span class="o">.</span><span class="na">getCredentialNickname</span><span class="o">(),</span>
                      <span class="n">response</span><span class="o">,</span>
                      <span class="n">registrationTry</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
                  <span class="o">),</span>
                  <span class="n">registrationTry</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">attestationTrusted</span><span class="o">()</span>
              <span class="o">)</span>
          <span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="o">...</span>
          <span class="k">return</span> <span class="n">Left</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Registration failed!"</span><span class="o">,</span> <span class="n">registrationTry</span><span class="o">.</span><span class="na">failed</span><span class="o">().</span><span class="na">get</span><span class="o">().</span><span class="na">getMessage</span><span class="o">()));</span>
      <span class="o">}</span>

  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_authentication">Authentication</h4>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="c1">// handles HTTPS requests to /authenticate</span>
<span class="kd">public</span> <span class="n">AssertionRequest</span> <span class="nf">startAuthentication</span><span class="o">(</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">AssertionRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AssertionRequest</span><span class="o">(</span>
        <span class="n">username</span><span class="o">,</span>
        <span class="n">U2fB64Encoding</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">challengeGenerator</span><span class="o">.</span><span class="na">generateChallenge</span><span class="o">()),</span>
        <span class="n">rp</span><span class="o">.</span><span class="na">startAssertion</span><span class="o">(</span>
            <span class="n">username</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">userStorage</span><span class="o">::</span><span class="n">getCredentialIdsForUsername</span><span class="o">),</span>
            <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">()</span>
        <span class="o">)</span>
    <span class="o">);</span>

    <span class="n">assertRequestStorage</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">(),</span> <span class="n">request</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">request</span><span class="o">;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="c1">// handles HTTPS requests to /authenticate/finish</span>
<span class="kd">public</span> <span class="n">Either</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;,</span> <span class="n">SuccessfulAuthenticationResult</span><span class="o">&gt;</span> <span class="nf">finishAuthentication</span><span class="o">(</span><span class="n">String</span> <span class="n">responseJson</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="kd">final</span> <span class="n">AssertionResponse</span> <span class="n">response</span><span class="o">;</span>
    <span class="o">...</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">jsonMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">responseJson</span><span class="o">,</span> <span class="n">AssertionResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">...</span>

    <span class="n">AssertionRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">assertRequestStorage</span><span class="o">.</span><span class="na">getIfPresent</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">());</span>
    <span class="n">assertRequestStorage</span><span class="o">.</span><span class="na">invalidate</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">());</span>

    <span class="o">...</span>
        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">returnedUserHandle</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getCredential</span><span class="o">().</span><span class="na">response</span><span class="o">().</span><span class="na">userHandleBase64</span><span class="o">());</span>

        <span class="kd">final</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getUsername</span><span class="o">().</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getUsername</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">userStorage</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(</span><span class="n">returnedUserHandle</span><span class="o">.</span><span class="na">get</span><span class="o">()).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="n">String</span> <span class="n">userHandle</span> <span class="o">=</span> <span class="n">returnedUserHandle</span><span class="o">.</span><span class="na">orElseGet</span><span class="o">(()</span> <span class="o">-&gt;</span>
            <span class="n">username</span> <span class="o">==</span> <span class="kc">null</span>
                <span class="o">?</span> <span class="kc">null</span>
                <span class="o">:</span> <span class="n">userStorage</span><span class="o">.</span><span class="na">getUserHandle</span><span class="o">(</span><span class="n">username</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">BinaryUtil</span><span class="o">::</span><span class="n">toBase64</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
        <span class="o">);</span>

        <span class="o">...</span>
            <span class="n">Try</span><span class="o">&lt;</span><span class="n">AssertionResult</span><span class="o">&gt;</span> <span class="n">assertionTry</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="na">finishAssertion</span><span class="o">(</span>
                <span class="n">request</span><span class="o">.</span><span class="na">getPublicKeyCredentialRequestOptions</span><span class="o">(),</span>
                <span class="n">response</span><span class="o">.</span><span class="na">getCredential</span><span class="o">(),</span>
                <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">userHandle</span><span class="o">,</span>
                <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">()</span>
            <span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">assertionTry</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">AssertionResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">assertionTry</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">success</span><span class="o">())</span> <span class="o">{</span>
                    <span class="o">...</span>
                        <span class="n">userStorage</span><span class="o">.</span><span class="na">updateSignatureCountForUsername</span><span class="o">(</span>
                            <span class="n">username</span><span class="o">,</span>
                            <span class="n">response</span><span class="o">.</span><span class="na">getCredential</span><span class="o">().</span><span class="na">id</span><span class="o">(),</span>
                            <span class="n">result</span><span class="o">.</span><span class="na">signatureCount</span><span class="o">()</span>
                        <span class="o">);</span>
                    <span class="o">...</span>

                    <span class="k">return</span> <span class="n">Right</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span>
                        <span class="k">new</span> <span class="n">SuccessfulAuthenticationResult</span><span class="o">(</span>
                            <span class="n">request</span><span class="o">,</span>
                            <span class="n">response</span><span class="o">,</span>
                            <span class="n">userStorage</span><span class="o">.</span><span class="na">getRegistrationsByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">)</span>
                        <span class="o">)</span>
                    <span class="o">);</span>
                <span class="o">...</span>
                <span class="o">}</span>

            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="o">...</span>
                <span class="k">return</span> <span class="n">Left</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Assertion failed!"</span><span class="o">,</span> <span class="n">assertionTry</span><span class="o">.</span><span class="na">failed</span><span class="o">().</span><span class="na">get</span><span class="o">().</span><span class="na">getMessage</span><span class="o">()));</span>
            <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>In the example above <code>assertRequestStorage</code> and <code>registerRequestStorage</code> are a <a href="https://en.wikipedia.org/wiki/Data_access_object" rel="noopener noreferrer" target="_blank">DAO</a> that stores
challenges temporarily. The other DAO, <code>userStorage</code>, persists data permanently.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">FIDO2 only works on HTTPS webpages.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_client_side">Client-side</h3>
<div class="paragraph"><p>This section assumes that you are building a web site. If this is not the case,
have a look at our <a href="/Software_Projects/FIDO2/FIDO2_Host_Libraries/">FIDO2 host libraries</a> instead.</p></div>
<div class="paragraph"><p>The main part of the client is to
be a middle-man between the server and the FIDO2 compliant device.</p></div>
<div class="paragraph"><p>The straightforward way to use FIDO2 in a supported browser is to use the Web Authentication API, which exposes two functions:</p></div>
<div class="hdlist"><table>
<tr>
<td class="hdlist1">
<code>navigator.credentials.create</code>
<br>
</br></td>
<td class="hdlist2">
<p style="margin-top: 0;">
Register using a FIDO2 device.
</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>navigator.credentials.get</code>
<br>
</br></td>
<td class="hdlist2">
<p style="margin-top: 0;">
Authenticate using a FIDO2 device.
</p>
</td>
</tr>
</table></div>
<div class="sect3">
<h4 id="_registration_2">Registration</h4>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">PublicKeyCredential</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Platform not capable. Handle error. */</span> <span class="p">}</span>

<span class="kd">var</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">challenge</span><span class="o">:</span> <span class="p">{</span><span class="nx">challenge</span><span class="p">},</span> <span class="c1">// The challenge must be produced by the server</span>

  <span class="c1">// Relying Party:</span>
  <span class="nx">rp</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">"Demo server"</span>
  <span class="p">},</span>

  <span class="c1">// User:</span>
  <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="p">{</span><span class="nx">user_id</span><span class="p">},</span> <span class="c1">// id may be generated by the server</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">"a.user@example.com"</span><span class="p">,</span>
    <span class="nx">displayName</span><span class="o">:</span> <span class="s2">"A User"</span><span class="p">,</span>
    <span class="nx">icon</span><span class="o">:</span> <span class="s2">"https://example.com/image.png"</span>
  <span class="p">},</span>

  <span class="c1">// This Relying Party will accept either an ES256 or RS256 credential, but</span>
  <span class="c1">// prefers an ES256 credential.</span>
  <span class="nx">pubKeyCredParams</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">"public-key"</span><span class="p">,</span>
      <span class="nx">alg</span><span class="o">:</span> <span class="o">-</span><span class="mi">7</span> <span class="c1">// "ES256" as registered in the IANA COSE Algorithms registry</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">"public-key"</span><span class="p">,</span>
      <span class="nx">alg</span><span class="o">:</span> <span class="o">-</span><span class="mi">257</span> <span class="c1">// Value registered by this specification for "RS256"</span>
    <span class="p">}</span>
  <span class="p">],</span>

  <span class="nx">excludeCredentials</span><span class="o">:</span> <span class="p">[],</span>
  <span class="nx">attestation</span><span class="o">:</span> <span class="s1">'direct'</span><span class="p">,</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60000</span><span class="p">,</span>
  <span class="nx">extensions</span><span class="o">:</span> <span class="p">{</span><span class="s2">"loc"</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>  <span class="c1">// Include location information in attestation</span>
<span class="p">};</span>

<span class="c1">// Note: The following call will cause the authenticator to display UI.</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="nx">publicKey</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">attestation</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Send new credential info to server for verification and registration.</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// No acceptable authenticator or user refused consent. Handle appropriately.</span>
  <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_authentication_2">Authentication</h4>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">PublicKeyCredential</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Platform not capable. Handle error. */</span> <span class="p">}</span>

  <span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
    <span class="nx">publicKey</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rpId</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">domain</span><span class="p">,</span>
      <span class="nx">challenge</span><span class="o">:</span> <span class="p">{</span><span class="nx">challenge</span><span class="p">},</span> <span class="c1">// The challenge must be produced by the server</span>
      <span class="nx">allowCredentials</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">'public-key'</span><span class="p">,</span>
          <span class="nx">id</span><span class="o">:</span> <span class="p">{</span><span class="nx">credential_id</span><span class="p">}</span> <span class="c1">// The credential_id may be provided by the server</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60000</span>
    <span class="p">}</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">assertion</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Send new credential info to server for verification and registration.</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// No acceptable authenticator or user refused consent. Handle appropriately.</span>
  <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>For a complete example, see
<a href="https://github.com/Yubico/java-webauthn-server/tree/master/webauthn-server-demo" rel="noopener noreferrer" target="_blank">this demo server</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_complete_example_code">Complete example code</h3>
<div class="paragraph"><p>For complete example code (both server and client) in various languages, have a look at <a href="List_of_libraries.html">respective FIDO2 library</a>'s accompanied demo server.</p></div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>